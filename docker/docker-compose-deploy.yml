version: '3.8'


services:

  rproxy:
    image: localhost:5000/rsww_175651-rproxy
    ports:
      - "17565:8088"
    networks:
      - net_internal

  axonserver:
    image: localhost:5000/rsww_175651-axonserver
    networks:
      - net_internal
      - net_postgres
      - net_mongo

  frontend:
    image: localhost:5000/rsww_175651-frontend
    environment:
      - RSWW_BACKEND_ADDR=routed
    networks:
      - net_internal
      - net_postgres
      - net_mongo

  svc_gateway:
    image: localhost:5000/rsww_175651-svc_gateway
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver
    ports:
      - "17565:1438"

  svc_hotel:
    image: localhost:5000/rsww_175651-svc_hotel
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver

  svc_flight:
    image: localhost:5000/rsww_175651-svc_flight
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver

  svc_payment:
    image: localhost:5000/rsww_175651-svc_payment
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver

  svc_saga_orchestrator:
    image: localhost:5000/rsww_175651-svc_saga_orchestrator
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver

  svc_tour_operator_cmd:
    image: localhost:5000/rsww_175651-svc_tour_operator_cmd
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver

  svc_tour_operator_query:
    image: localhost:5000/rsww_175651-svc_tour_operator_query
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver

  svc_travel_agency:
    image: localhost:5000/rsww_175651-svc_travel_agency
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - RSWW_AXONSERVERS=axonserver


networks:
  net_mongo:
    external: true
    name: admin-mongodb_default
  net_postgres:
    external: true
    name: admin-postgres_default
  net_internal:
    driver: overlay
    name: rsww_175651_net
    ipam:
      driver: default
      config:
        - subnet: "10.10.0.0/16"
          gateway: "10.10.0.1"

